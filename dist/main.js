!function(t){var e={};function r(l){if(e[l])return e[l].exports;var n=e[l]={i:l,l:!1,exports:{}};return t[l].call(n.exports,n,n.exports,r),n.l=!0,n.exports}r.m=t,r.c=e,r.d=function(t,e,l){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:l})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var l=Object.create(null);if(r.r(l),Object.defineProperty(l,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)r.d(l,n,function(e){return t[e]}.bind(null,n));return l},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=0)}([function(t,e,r){"use strict";function l(t,e){var r,l=e;return window.location.href.indexOf(t)>-1&&(l=(r={},window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi,(function(t,e,l){r[e]=l})),r)[t]),l}r.r(e);var n=l("dataset","http://visualisation.jmatejik.eu/data/example2.json"),a=l("maxdepth","10"),i=parseInt(a);const o=new XMLHttpRequest;o.open("GET",n,!1),o.send(null);var s=JSON.parse(o.responseText),u=function(t){let e=[];for(let r=0;r<t.hierarchy.length;r++){let l={};l.id=r,l.source=t.hierarchy[r][2],l.target=t.hierarchy[r][0],e.push(l)}return e}(s),c=h(u),d=function(t,e){let r=[];r.push({from:"Select",to:"path..."});let l=h(e);if(console.log(t),null==t.paths)return;for(let e=0;e<t.paths.length;e++){let n={};n.from=t.paths[e].from[0],n.to=t.paths[e].to[0],n.vertices=[];for(let r=0;r<t.paths[e].path.length;r++)n.vertices.push(t.paths[e].path[r]);n.directions=[];for(let t=0;t<n.vertices.length-1;t++){void 0===l.filter(e=>e.url===n.vertices[t])[0].parents.filter(e=>e.url===n.vertices[t+1])[0]?n.directions.push(0):n.directions.push(1)}let a=0,i=0;for(let t=0;t<n.directions.length;t++)1==n.directions[t]?a++:i++;n.up=a,n.down=i,n.height=0,n.height=a>i?a:i,r.push(n)}return console.log(r),r}(s,u);function h(t){let e=function(t){let e=[],r=[],l={color:null,depth:null,isInPath:null,pathDepth:null,title:null,parents:[],children:[],shortcut:"",url:"root"};r.push(l);for(let l=0;l<t.length;l++){if(!e.includes(t[l].target)){e.push(t[l].target);let n={color:null,depth:null,isInPath:null,pathDepth:null,title:null,parents:[],children:[],shortcut:null};n.url=t[l].target,r.push(n)}if(!e.includes(t[l].source)){e.push(t[l].source);let n={color:null,depth:null,isInPath:null,pathDepth:null,title:null,parents:[],children:[],shortcut:null};n.url=t[l].source,r.push(n)}}return r}(t);for(let r=0;r<e.length;r++){let l=e[r].url;for(let n=0;n<t.length;n++){if(t[n].target==l){let l=e.filter(e=>e.url==t[n].source)[0];e[r].parents.push(l)}if(t[n].source==l){let l=e.filter(e=>e.url==t[n].target)[0];e[r].children.push(l)}}}let r=e.filter(t=>0==t.parents.length),l=e.filter(t=>"root"==t.url)[0];for(let t=0;t<r.length;t++)"root"!=r[t].url&&(r[t].parents.push(l),l.children.push(r[t]));for(let t=0;t<e.length;t++)e[t].id=t;return e}var p=0;function f(t,e){p=0;let r=g((c=h(u)).filter(e=>e.id===t)[0]);r.depth=0,c[r.id]=r.depth;let l,n=[];for(n.push(r);0!=n.length;)if(l=n.shift(),null==l&&console.log("jsem zde"),null==l.children&&console.log("jsem zde"),0!=l.children.length)for(let t=0;t<l.children.length;t++){const r=g(l.children[t]);l.children[t]=r,r.depth=l.depth+1,console.log(r.depth),p<l.depth+1&&(p=l.depth+1),c[r.id].depth=r.depth,l.depth+1<e?n.push(l.children[t]):l.depth+1==e&&(l.children[t].children=[],l.children[t].value=1)}else l.children=[],l.value=1;return r}function g(t){return Object.assign({},t)}var v=0;function y(t){v=t}var x=void 0;function m(t){x=t}var w=[],b=[];let k=d3.select("#visualisation").attr("width",840).attr("height",720);var O=d3.select("#zoomRange");let j=d3.select("#selectedPath").attr("width",840);var P=k.append("g").attr("transform","translate(420,360)"),z=j.append("g"),A=j.append("svg"),I=d3.select("#actual-path").attr("height",0).attr("width",840),L=I.append("g").attr("height",0).attr("width",840),M=d3.tip().attr("class","d3-tip").direction("e").offset([0,5]).html((function(t){return'\n                    <table style="margin-top: 2.5px;">\n                            <tr><td>Url: </td><td style="text-align: right">'+t.data.url+'</td></tr>\n                            <tr><td>Id: </td><td style="text-align: right">'+t.data.id+"</td></tr>\n                    </table>\n                    "}));k.call(M);var S,R,_,H,T,W=1;function B(t){W=t}var D,E,q,C,X=[],G=[],J=[];function K(t){J=t}function N(t,e,r,l){S=f(t,i);var n=p;if(document.getElementById("zoomRange").value=W,document.getElementById("zoomRange").max=n,S=f(t,e),O.attr("max",n).attr("value",W),null!=x){let t=d3.scaleLinear().domain([0,x.height]).range(["#ff8d92","#ff0000"]).interpolate(d3.interpolateCubehelix),e=[];e.push(S);let r=[];for(;0!=e.length;){let t=e.shift();if(r.push(t),null!=t.children&&null!=t.children)for(let r=0;r<t.children.length;r++)e.push(t.children[r])}for(let e=0;e<x.vertices.length;e++){let l=r.filter(t=>t.url===x.vertices[e])[0];if(null!=l){l.color=t()}}let l=x.up,n=(x.down,0),a=0;x.colours=[];for(let e=0;e<x.vertices.length;e++){let i=r.filter(t=>t.url===x.vertices[e])[0],o=0;l>0?(o=n*x.height/x.up,n++,l--):(o=(x.height-a)*x.height/x.down,a++),x.colours.push(t(o)),null!=i&&(i.color=t(o))}let i=1680/(2*x.vertices.length+x.directions.length),o=i/2;C=[],q=[];for(let t=0;t<x.vertices.length;t++){let e={};e.x=t*i+t*o+i/2,e.y=100,e.color=x.colours[t],e.r=25,e.text=x.vertices[t],q.push(e)}for(let t=0;t<x.directions.length;t++){let e={};1===x.directions[t]?e.text="↑":e.text="↓",e.y=100,e.x=(t+1)*i+t*o+o/2,C.push(e)}j=d3.select("#selectedPath").attr("height",200),z.remove(),A.remove(),z=j.append("g").attr("width",840).attr("height",i),A=j.append("svg").attr("width",840).attr("height",i),z.selectAll("circle").data(q).enter().append("circle").attr("cx",(function(t){return t.x})).attr("cy",(function(t){return t.y})).attr("fill",(function(t){return t.color})).attr("class","hint-node").attr("r",(function(t){return t.r})).on("click",Q),A.selectAll("text").data(q).enter().append("text").attr("x",(function(t){return t.x})).attr("y",(function(t){return t.y})).attr("font-size","20px").attr("class","hint-label").text((function(t){return t.text})),z.selectAll("text").data(C).enter().append("text").attr("x",(function(t){return t.x})).attr("y",(function(t){return t.y})).attr("font-size","20px").text((function(t){return t.text}))}else z.remove(),A.remove();_=d3.pack().size([840,720]).padding(10),S=d3.hierarchy(S).sum(t=>Math.sqrt(t.value)),S,R=_(S).descendants();let a=d3.scaleLinear().domain([0,e]).range(["HSL(0, 0%, 80%)","HSL(0, 0%, 20%)"]).interpolate(d3.interpolateCubehelix);var o,s;if(P.remove(),P=k.append("g").attr("transform","translate(420,360)"),H=P.selectAll("circle").data(R).enter().append("circle").attr("class",(function(t){return t.parent?t.children?"node":"node node--leaf":"node node--root"})).style("fill",(function(t){return t.data.color?t.data.color:a(t.depth)})).on("click",F).on("mouseover",M.show).on("mouseout",M.hide),P.selectAll("text").data(R).enter().append("text").attr("class",(function(t){return t.parent?t.children?"label":"label label--leaf":"label label--root"})).style("fill","white").style("font-size",(function(t){return t.r/2})).attr("dy",".35em").text((function(t){return t.data.url.startsWith("https://www.wikidata.org/wiki")?t.data.url.split("/")[4].substring(0,5):t.data.url.length<4?t.data.url:t.data.url.substring(0,5)})),T=P.selectAll("circle,text"),k.style("background","white"),o=[S.x,S.y,2*S.r+0],s=720/o[2],o,T.attr("transform",(function(t){return"translate("+(t.x-o[0])*s+","+(t.y-o[1])*s+")"})),H.attr("r",(function(t){return t.r*s})),null==r&&null==l||(function(t,e){X=[],G=[];let r=[],l=[];r.push(S);for(;0!=r.length;){let t=r.shift();if(l.push(t),null!=t.children&&null!=t.children)for(let e=0;e<t.children.length;e++)r.push(t.children[e])}if(null!=t&&null!=t){let e=V(t);for(let t=0;t<e.length;t++){let r=l.filter(r=>r.data.id===e[t])[0],n={},a={x:0,y:360};n.from=a;let i={};i.x=r.x,i.y=r.y,i.r=r.r,n.to=i,X.push(n)}}if(null!=e&&null!=e){let t=V(e);for(let e=0;e<t.length;e++){let r=l.filter(r=>r.data.id===t[e])[0],n={},a={x:840,y:360};n.from=a;let i={};i.x=r.x,i.y=r.y,i.r=r.r,n.to=i,G.push(n)}}}(r,l),function(){void 0!==D&&D.remove();void 0!==E&&E.remove();k.append("svg:defs").append("svg:marker").attr("id","arrow").attr("viewBox","0 -5 10 10").attr("refX",9).attr("markerWidth",11).attr("markerHeight",6).attr("orient","auto").attr("fill","yellow").append("svg:path").attr("d","M0,-5L10,0L0,5"),D=k.selectAll("links").data(X).enter().append("svg:line").attr("class","links").attr("stroke","yellow").style("stroke-width",2).attr("x1",(function(t){return t.from.x})).attr("y1",(function(t){return t.from.y})).attr("x2",(function(t){return t.to.x-t.to.r})).attr("y2",(function(t){return t.to.y})).attr("marker-end",t=>"url(#arrow)"),E=k.selectAll("links").data(G).enter().append("svg:line").attr("class","links").attr("stroke","yellow").style("stroke-width",2).attr("x1",(function(t){return t.from.x})).attr("y1",(function(t){return t.from.y})).attr("x2",(function(t){return t.to.x+t.to.r})).attr("y2",(function(t){return t.to.y})).attr("marker-end",t=>"url(#arrow)")}()),0!=J.length){let t=840;var u=[],d=0,h=Math.floor((t-144)/10/2),g=Math.floor(J.length/10),v=J.length%10;for(let t=0;t<g;t++){for(let e=0;e<10;e++){let r={};r.x=2*e*8+2*e*h+h,r.y=2*t*h+2*t*8+h,r.r=h,r.id=J[10*t+e];let l=c.filter(t=>t.id==r.id)[0].url;l.startsWith("https://www.wikidata.org/wiki")?l=l.split("/")[4].substring(0,4)+"...":l.length<4||(l=l.substring(0,4)+"..."),r.text=l,u.push(r)}d+=1}for(let t=0;t<v;t++){let e={};e.x=2*t*8+2*t*h+h,e.y=2*d*h+2*d*8+h,e.id=J[10*d+t];let r=c.filter(t=>t.id==e.id)[0].url;r.startsWith("https://www.wikidata.org/wiki")?r=r.split("/")[4].substring(0,4)+"...":r.length<4||(r=r.substring(0,4)+"..."),e.text=r,e.r=h,u.push(e)}let e=2*d*h+16+h+h;I.attr("height",e).attr("width",t),L.remove(),L=I.append("g").attr("height",e).attr("width",t),L.selectAll("circle").data(u).enter().append("circle").attr("cx",(function(t){return t.x})).attr("cy",(function(t){return t.y})).attr("fill","gray").attr("class","hint-node").attr("r",(function(t){return t.r})).on("click",U),L.selectAll("text").data(u).enter().append("text").attr("x",(function(t){return t.x})).attr("y",(function(t){return t.y})).attr("class","hint-label").attr("font-size","20px").text((function(t){return t.text}))}else I=d3.select("#actual-path").attr("height",0).attr("width",840),L.remove(),L=I.append("g").attr("height",0).attr("width",840)}function U(t){let e=J.indexOf(t.id);W=1,J=J.slice(0,e);c.filter(e=>e.url===t.text)[0];N(v=t.id,W,w,b)}function F(t){var e;if(d3.event.ctrlKey)e=t.data.url,window.open(e,"_blank").focus();else if(W=1,0!==c.filter(e=>e.url===t.data.url)[0].children.length){for(var r=t,l=[];null!=r.parent;)r=r.parent,l.push(r);for(;0!=l.length;){var n=l.pop();J.push(n.data.id)}null!=t.data.id&&(v=t.data.id),function(t){v=0===t?0:t.data.id;N(v,W,w,b)}(t)}d3.event.stopPropagation()}function Q(t){!function(t){N(v=parseInt(t.text),W,w,b)}(t),d3.event.stopPropagation()}function V(t){let e=[];for(let l=0;l<t.length;l++){let n=c.filter(e=>e.url===t[l])[0];if(console.log(n),console.log("parent"),void 0===n)continue;var r=[];r.push(n);let a=0,i=[];for(;0!=r.length;){let t=r.pop();if(console.log(t),a++,i.includes(t.id))i=[];else if(null!==t.parents)if(i.push(t.id),null==t.depth){if(null!=t.parents)for(let e=0;e<t.parents.length;e++)r.push(t.parents[e])}else e.includes(t.id)||e.push(t.id);else i=[]}}return e}var Y=$(0,s.mappings[0]),Z=$(1,s.mappings[1]);console.log(window.location.href),N(v,W,w,b),nt();d3.select("#zoomRange").on("input",(function(){B(parseInt(d3.select(this).property("value"))),N(v,W,w,b)}));function $(t,e){let r=[],l={},n=[];for(let t=0;t<e.data.length;t++){let r={};r.id=e.data[t].id,r.by=e.data[t].metadata.group,null==n[e.data[t].metadata.group]&&(n[e.data[t].metadata.group]=[]),n[e.data[t].metadata.group].push(r)}for(var a in l.url="root",r.push(l),n){let t={};t.url=a,t.parent=l.url,r.push(t);for(let e=0;e<n[a].length;e++){let l={};l.url=n[a][e].id,l.parent=t.url,r.push(l)}}return console.log("tree"),console.log(r),r}function tt(t,e,r){"root"!=e.parent&&t.append("input").attr("type","checkbox").attr("class","label-tree").on("change",(function(t){if(this.checked)switch(r){case 0:w.push(t.data.url);break;case 1:b.push(t.data.url)}else{let e=-1;switch(r){case 0:e=w.indexOf(t.data.url),-1!==e&&w.splice(e,1);break;case 1:e=b.indexOf(t.data.url),-1!==e&&b.splice(e,1)}}N(v,W,w,b)})),t.append("span").text(e.url)}function et(t,e,r){const l=t.append("span");l.append("span").classed("arrow",!0);if(l.call(tt,e.data,r),!e.hasOwnProperty("children"))return;const n=t.append("ul").style("list-style-type","none").selectAll("li").data(e.children,t=>t.url);n.exit().remove(),n.enter().append("li").merge(n).each((function(t){d3.select(this).call(et,t,r)})),l.select(".arrow").text("▼ ").on("click",(function(){const e=t.select("ul");if(!e.size())return;const r="none"!==e.style("display");d3.select(this).text(r?"▶ ":"▼ "),e.style("display",r?"none":"inherit")}))}function rt(t){t.classed("viewport",!0).style("overflow-y","scroll").style("overflow-x","hidden").style("height","720px").append("div").classed("body",!0).style("transform","scale(1.5)").style("transform-origin","top left")}function lt(t,e,r){const l=d3.stratify().id(t=>t.url).parentId(t=>t.parent)(e);t.select(".body").call(et,l,r),t.select(".body > span").remove(),t.select(".body > ul").style("padding-left",0)}function nt(){d3.select("#treeLeft div").remove(),d3.select("#treeLeft").append("div").call(rt).call(lt,Y,0),d3.select("#treeRight div").remove(),d3.select("#treeRight").append("div").call(rt).call(lt,Z,1)}d3.select("#paths").on("input",(function(){var t=parseInt(d3.select(this).property("value"));e=[],void(w=e),function(t){b=t}([]),0!=t?(m(d[t]),B(1),y(parseInt(x.vertices[x.up])),K([]),w.push(x.vertices[0]),b.push(x.vertices[x.vertices.length-1])):(y(0),K([]),B(1),m(void 0),nt());var e;N(v,W,w,b)})).selectAll("option").data(d).enter().append("option").attr("value",(function(t,e){return e})).text((function(t){return t.from+" to "+t.to}))}]);